#textdomain wesnoth-wov
# This scenario is intended to be hard difficulty.
[scenario]
    id=08_Foothills
    name= _ "Foothills"
    next_scenario=09_Heart_Mountains
    {WOV_MAP 08_Foothills.map}
    {UNDERGROUND}
    ## {TURNS 40 40 40}
    turns=unlimited
    victory_when_enemies_defeated=no
    carryover_percentage=40
    carryover_add=yes

    {INTRO_AND_SCENARIO_MUSIC revelation.ogg the_deep_path.ogg}
    {EXTRA_SCENARIO_MUSIC into_the_shadows.ogg}
    {EXTRA_SCENARIO_MUSIC underground.ogg}

    [story]
        [part]
            background=story/landscape-hills-01.jpg
            story= _ "The main body of Flight Gorlack descended upon a rocky mountainside overlooking the forest of Wesmere. There, Dominant Gorlack waited for his remaining wings of hunters to rejoin them."
        [/part]
    [/story]
    {WOV_GC_TRACK {JOURNEY_08_NEW}}

    # wmllint: validate-off
    [side]
        side=1
        controller=human
        recruit=Drake Burner, Drake Clasher, Drake Fighter, Drake Glider, Saurian Augur, Saurian Skirmisher
        gold=400 # since no carryover from last scenario
        fog=no
        shroud=yes
        save_id=Player
        team_name=hero
        user_team_name= _ "Drakes"
        side_name= _ "Gorlack"
        {FLAG_VARIANT long}
        [leader]
            {GORLACK}
        [/leader]
        [unit]
            {RESHAN}
            placement=leader
        [/unit]
        [unit]
            {ARINEXIS}
            placement=leader
        [/unit]
        [unit]
            {ZEDRIX}
            placement=leader
        [/unit]
    [/side]
    {SECOND_INTENDANT_REPLACEMENT_EVENTS}
    {WOV_DEATHS}

    [side]
        side=2
        controller=ai
        recruit=Revenant, Deathblade, Bone Shooter, Wraith, Shadow, Blood Bat, Dark Sorcerer
        {GOLD 100 200 300}
        {INCOME 4 8 12}
        team_name=undead
        user_team_name= _ "Undead"
        {FLAG_VARIANT undead}
        [leader]
            id=Lich-Lord Siravan
            name= _ "Lich-Lord Siravan"
            type=Ancient Lich
            facing=sw
        [/leader]
        {UNIT () (Gate)  08 22 (facing=se)}
        {UNIT () (Gate)  09 23 (facing=se)}
        {UNIT () (Gate)  10 23 (facing=se)}

        {UNIT () (Gate)  12 24 (facing=se)}
        {UNIT () (Gate)  13 25 (facing=se)}
        {UNIT () (Gate)  14 25 (facing=se)}
        {UNIT () (Gate)  15 26 (facing=se)}

        {UNIT () (Gate)  17 27 (facing=se)}
        {UNIT () (Gate)  18 27 (facing=se)}
        {UNIT () (Gate)  19 28 (facing=se)}

        {UNIT () (Gate)  24 28 (facing=se)}

        {UNIT () (Gate)  26 29 (facing=se)}
    [/side]
#ifdef HARD
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Shadow" 1} # One is bad enough
#else
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Shadow" 0}
#endif

    [side]
        side=3
        controller=ai
        recruit=Giant Spider
        {GOLD 25 50 75}
        {INCOME 2 4 6}
        team_name=undead
        user_team_name= _ "Spiders"
        {FLAG_VARIANT undead}
        [leader]
            id=Pet Spider
            type=Giant Spider
            facing=nw
        [/leader]
        [ai]
            aggression=0.70
            [avoid]
                terrain=*^Vu
            [/avoid]
        [/ai]
    [/side]

    [side]
        side=4
        controller=ai
        recruit=Water Serpent
        {GOLD 50 100 150}
        {INCOME 4 8 12}
        team_name=undead
        user_team_name= _ "Serpents"
        {FLAG_VARIANT undead}
        [leader]
            id=Pet Serpent
            type=Water Serpent
            facing=sw
        [/leader]
        [ai]
            aggression=0.70
            [avoid]
                terrain=*^Vu
            [/avoid]
        [/ai]
    [/side]

    [side]
        side=5
        controller=ai
        gold=0
        {NO_INCOME}
        team_name=elves
        user_team_name= _ "Elves"
        {FLAG_VARIANT wood-elvish}
        no_leader=yes
        defeat_condition=never
        # units placed and spawned in events
        [ai]
            aggression=0.70
            # TODO: Focus on killing drakes
        [/ai]
    [/side]
    # wmllint: validate-on

    [event]
        name=prestart

#define MOVE_ENEMY ID SIDE UNIT_SIDE KEEP CASTLE BORDER VILLAGE
        [terrain]
            terrain={KEEP}
            [and]
                terrain=K*
            [/and]
            [and]
                location_id={SIDE}
                radius=5
            [/and]
        [/terrain]
        [terrain]
            terrain={CASTLE}
            [and]
                terrain=C*
            [/and]
            [and]
                location_id={SIDE}
                radius=5
            [/and]
        [/terrain]
        [terrain]
            terrain={BORDER}
            [and]
                terrain=R*
            [/and]
            [and]
                location_id={SIDE}
                radius=5
            [/and]
        [/terrain]
        [terrain]
            terrain=^{VILLAGE}
            layer=overlay
            [and]
                terrain=*^V*
            [/and]
            [and]
                location_id={SIDE}
                radius=5
            [/and]
        [/terrain]
        # unit doesn't support location_id in 1.14, so get
        [store_starting_location]
            side={SIDE}
        [/store_starting_location]
        [unit]
            id={ID}
            side={UNIT_SIDE}
            type=Peasant # replaced by type of recalled unit via id
            x,y=$location.x,$location.y
        [/unit]
        {CLEAR_VARIABLE location}
        [store_unit]
            [filter]
                id={ID}
            [/filter]
            variable=unit
        [/store_unit]
        {CAPTURE_VILLAGES $unit.side $unit.x $unit.y 5}
        {CLEAR_VARIABLE unit}
#enddef

        # Randomly place each enemy leader, along with their castle, village, and surrounding terrein style
        # Place the exit behind the lich
        {PUT_TO_RECALL_LIST (id=Lich-Lord Siravan,Pet Spider,Pet Serpent)}
        {RANDOM 1..6}
        [switch]
            variable=random
            [case]
                value=1
                {MOVE_ENEMY (Lich-Lord Siravan) 2 2 Kud Cud Hh  Vwm}
                {MOVE_ENEMY (Pet Spider)        3 3 Kte Cte Uh  Vud}
                {MOVE_ENEMY (Pet Serpent)       4 4 Kme Cme Wwg Vm}
                {MODIFY_TERRAIN Urb             52 01} # moveto escape event triggered by terrain
                {PLACE_IMAGE items/gohere.png   52 01}
                {NAMED_UNIT 2 (Cairn) 50 02 (Passage_Gate) ( _ "Passage Gate") (facing=sw)} # Slows the player's escape through the mountain.
            [/case]
            [case]
                value=2
                {MOVE_ENEMY (Lich-Lord Siravan) 2 2 Kud Cud Hh  Vwm}
                {MOVE_ENEMY (Pet Spider)        4 3 Kte Cte Uh  Vud}
                {MOVE_ENEMY (Pet Serpent)       3 4 Kme Cme Wwg Vm}
                {MODIFY_TERRAIN Urb             52 01}
                {PLACE_IMAGE items/gohere.png   52 01}
                {NAMED_UNIT 2 (Cairn) 50 02 (Passage_Gate) ( _ "Passage Gate") ()}
            [/case]
            [case]
                value=3
                {MOVE_ENEMY (Lich-Lord Siravan) 3 2 Kud Cud Hh  Vwm}
                {MOVE_ENEMY (Pet Spider)        2 3 Kte Cte Uh  Vud}
                {MOVE_ENEMY (Pet Serpent)       4 4 Kme Cme Wwg Vm}
                {MODIFY_TERRAIN Urb             52 37}
                {PLACE_IMAGE items/gohere.png   52 37}
                {NAMED_UNIT 2 (Cairn) 50 37 (Passage_Gate) ( _ "Passage Gate") ()}
            [/case]
            [case]
                value=4
                {MOVE_ENEMY (Lich-Lord Siravan) 3 2 Kud Cud Hh  Vwm}
                {MOVE_ENEMY (Pet Spider)        4 3 Kte Cte Uh  Vud}
                {MOVE_ENEMY (Pet Serpent)       2 4 Kme Cme Wwg Vm}
                {MODIFY_TERRAIN Urb             52 37}
                {PLACE_IMAGE items/gohere.png   52 37}
                {NAMED_UNIT 2 (Cairn) 50 37 (Passage_Gate) ( _ "Passage Gate") ()}
            [/case]
            [case]
                value=5
                {MOVE_ENEMY (Lich-Lord Siravan) 4 2 Kud Cud Hh  Vwm}
                {MOVE_ENEMY (Pet Spider)        2 3 Kte Cte Uh  Vud}
                {MOVE_ENEMY (Pet Serpent)       3 4 Kme Cme Wwg Vm}
                {MODIFY_TERRAIN Urb             14 01}
                {PLACE_IMAGE items/gohere.png   14 01}
                {NAMED_UNIT 2 (Cairn) 16 02 (Passage_Gate) ( _ "Passage Gate") ()}
            [/case]
            [else]
                # value=6 and "can't happen, but just in case" case
                {MOVE_ENEMY (Lich-Lord Siravan) 4 2 Kud Cud Hh  Vwm}
                {MOVE_ENEMY (Pet Spider)        3 3 Kte Cte Uh  Vud}
                {MOVE_ENEMY (Pet Serpent)       2 4 Kme Cme Wwg Vm}
                {MODIFY_TERRAIN Urb             14 01}
                {PLACE_IMAGE items/gohere.png   14 01}
                {NAMED_UNIT 2 (Cairn) 16 02 (Passage_Gate) ( _ "Passage Gate") ()}
            [/else]
        [/switch]
        {CLEAR_VARIABLE random}

        # Convert terrain around serpent into gray water (except impassable)
        [store_unit]
            [filter]
                id=Pet Serpent
            [/filter]
            variable=unit
        [/store_unit]
        [terrain]
            terrain=Wwg
            [and]
                x,y=$unit.x,$unit.y
                radius=4
            [/and]
            [not]
                terrain=Xu,Qxu,Kme,Cme,*^V*
            [/not]
        [/terrain]
        [terrain]
            terrain=Wwg
            layer=base
            [and]
                x,y=$unit.x,$unit.y
                radius=4
            [/and]
            [and]
                terrain=*^Vm
            [/and]
        [/terrain]
       {CLEAR_VARIABLE unit}

        # For outside of the cave
        [time_area]
            terrain=M*,H*,G*,*^F*,Cud,Kud
            {DEFAULT_SCHEDULE_DUSK} #It's autumn
        [/time_area]

        # Place barrels & dark powder around entrance
        # Map uses Uue for location. Store the terrain, place a barrel on each, then convert to Uu
        [store_locations]
            terrain=Uue
            variable=barrels
        [/store_locations]
        [foreach]
            array=barrels
            [do]
                {PLACE_IMAGE items/barrel.png $this_item.x $this_item.y}
                {MODIFY_TERRAIN Uu $this_item.x $this_item.y}
            [/do]
        [/foreach]
        {CLEAR_VARIABLE barrels}
        # TODO: image for dark powder

        {CLEAR_VARIABLE escaped_units} #initialize

        # Place units for opening dialog
        [hide_unit]
            id=Reshan
        [/hide_unit]
        {TELEPORT_UNIT id=Reshan   01 39}
        {TELEPORT_UNIT id=Arinexis 22 31}
        {TELEPORT_UNIT id=Zedrix   21 30}
        {MODIFY_UNIT side=1 facing sw}

        [remove_shroud]
            [filter]
                id=Reshan
            [/filter]
            radius=21
        [/remove_shroud]

        [objectives]
            [objective]
                description= _ "Seek the passage through the mountain"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Gorlack"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Reshan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Arinexis"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Zedrix"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
            [note]
                description= _ "Flee members of our Flight through the passage. (Move units on to the exit tile to flee them.) (Those left behind not on the recall list will perish.)"
            [/note]
            [note]
                description= _ "Flee Gorlack and Reshan through the passage last. (Move units to the exit tile to flee them.)"
            [/note]
            [note]
                description= _ "The main mass of frenzied prey arrives in two days. (Turn 13)"
            [/note]
        [/objectives]
    [/event]

    # Hack to prevent inanimate gate units representing from turning to face their attacker.
    [event]
        name=attack_end
        first_time_only=no
        [filter_second]
            type=Gate
        [/filter_second]
        [modify_unit]
            [filter]
                type=Gate
            [/filter]
            facing=se
        [/modify_unit]
    [/event]
    [event]
        name=attack_end
        first_time_only=no
        [filter_second]
            type=Gate
        [/filter_second]
        [modify_unit]
            [filter]
                type=Gate
            [/filter]
            facing=se
        [/modify_unit]
    [/event]

    [event]
        name=start
        [message]
            speaker=Arinexis
            message= _ "To command respect, our alliance with dragonsss mussst have <b>ssome</b> name!"
        [/message]
        [message]
            speaker=Zedrix
            message= _ "‘Sibblingss of Ssetting Sssun’"
        [/message]
        [message]
            speaker=Arinexis
            message= _ "‘Union of Saurgrath and Morogor’"
        [/message]
        [message]
            speaker=Zedrix
            message= _ "‘Alignment of Moon and Sssun’"
        [/message]
        [message]
            speaker=Arinexis
            message= _ "‘Sandwalkersss’"
        [/message]
        [message]
            speaker=Zedrix
            message= _ "‘Alliance of Sseven Ssilver Starsss and Five Fish of Firmament’"
        [/message]
        [message]
            speaker=Arinexis
            message= _ "‘Sandfolksss’!"
        [/message]
        [message]
            speaker=Zedrix
            message= _ "Ah, that is mosst favored name - ‘Sandfolkss’ - bland yet no negative connotationss which sssummon…"
        [/message]
        [message]
            speaker=Gorlack
            message= _ "You <b>will</b> be silent."
        [/message]
        {MODIFY_UNIT id=Reshan facing ne}
        [unhide_unit]
            id=Reshan
        [/unhide_unit]
        [scroll_to_unit]
            id=Reshan
        [/scroll_to_unit]
        [delay]
            time=1000
        [/delay]
        [move_unit]
            id=Reshan
            to_x,to_y=20,31
        [/move_unit]
        [message]
            speaker=Gorlack
            message= _ "Report, Reshan. There are still three wings yet to regather."
        [/message]
        [message]
            speaker=Reshan
            message= _ "Gorlack, they are routed. The forest withheld the prey’s true number. A throng of them pursues us here.

We must retreat to the eyrie with due haste."
        [/message]
        [message]
            speaker=Gorlack
            message= _ "Our haul is too weighty to be flown with a dozen trips. We can not forsake it. Too much depends on it."
        [/message]
        [message]
            speaker=Arinexis
            message= _ "Through thiss cave! Essscape through here…"
        [/message]
        [move_unit]
            id=Arinexis
            to_x,to_y=26,28
        [/move_unit]
        [redraw]
            clear_shroud=yes
        [/redraw]
        {MODIFY_UNIT side=1 facing ne}
        [message]
            speaker=Zedrix
            message= _ "With care, Arinexisss, with care! Fire dussst isss ssstrewn about."
        [/message]
        [message]
            speaker=Arinexis
            message= _ "Dragonsss, do not breath on the dussst!"
        [/message]
        [message]
            speaker=Reshan
            message= _ "Fire Dust… enough to bring down this cave behind us…"
        [/message]
        [message]
            speaker=Gorlack
            message= _ "… a Cave."
        [/message]
        [message]
            speaker=Reshan
            message= _ "Gorlack, you know we must brave it…

We will do this. Together. You got me out of <b>That</b> cave alive. I swear to you, Gorlack, I will repay you this."
        [/message]
        [message]
            speaker=Gorlack
            message= _ "Reshan… about That cave… there is something…"
        [/message]
        [sound]
            name=horn-signals/horn-1.ogg
        [/sound]
        [delay]
            time=4000 # so sound finishes before dialog starts
        [/delay]
        {SCATTER_UNITS 5 "Elvish Outrider,Elvish Rider,Elvish Rider,Elvish Rider,Elvish Rider" 0 (
            x=14-18
            y=35-37
            terrain=*^F*
            {SCATTER_NOT_NEXT}
         ) (side,facing=5,ne)}
        {MODIFY_UNIT side=1 facing sw}
        [message]
            speaker=Reshan
            message= _ "Land gliders! I never expected they possessed such swiftness. Their aim must be to delay us."
        [/message]
        [message]
            speaker=Gorlack
            message= _ "I need a few to hold a line across the mouth. The rest of you, into the cave!"
        [/message]
    [/event]

    [event]
        name=side 5 turn refresh
        first_time_only=no
        [filter_condition]
            [lua]
                code=<< return (wesnoth.get_variable("turn_number") % 3 == 0) >>
            [/lua]
        [/filter_condition]
        [sound]
            name=horn-signals/horn-1.ogg
        [/sound]
        [scroll_to]
            x,y=14,34
        [/scroll_to]
        {SCATTER_UNITS {ON_DIFFICULTY 2 3 4} "Elvish Champion,Elvish Sharpshooter,Elvish Enchantress" 1 (
            {EVERYWHERE}
            terrain=*^F*
            {SCATTER_NOT_NEXT}
        ) (side,moves,facing=5,0,ne)}
    [/event]

    [event]
        name=side 5 turn refresh
        first_time_only=no
        [filter_condition]
            [lua]
                code=<< return (wesnoth.get_variable("turn_number") % 4 == 0) >>
            [/lua]
        [/filter_condition]
        [sound]
            name=horn-signals/horn-1.ogg
        [/sound]
        [scroll_to]
            x,y=14,34
        [/scroll_to]
        {SCATTER_UNITS {ON_DIFFICULTY 1 2 3} "Elvish Sylph,Ancient Wose" 1 (
            {EVERYWHERE}
            terrain=*^F*
            {SCATTER_NOT_NEXT}
        ) (side,moves,facing=5,0,ne)}
    [/event]

    [event]
        name=sighted
        id=see lich
        [filter]
            id=Lich-Lord Siravan
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [scroll_to_unit]
            id=Lich-Lord Siravan
        [/scroll_to_unit]
        # clear shroud around lich so it looks better
        [remove_shroud]
            [filter]
                id=Lich-Lord Siravan
            [/filter]
            radius=5
        [/remove_shroud]
        [delay]
            time=1500
        [/delay]
        [message]
            speaker=Lich-Lord Siravan
            message= _ "Come to test me yet again, Krahkrahs?"
        [/message]
        [message]
            speaker=Zedrix
            message= _ "It isss to hisss sstronger brother Shek’kahan you ssspeak!"
        [/message]
        [message]
            speaker=Lich-Lord Siravan
            message= _ "As you say."
        [/message]
        [message]
            speaker=Gorlack
            message= _ "I will have passage through this mountain. You are advised to move aside."
        [/message]
        [message]
            speaker=Lich-Lord Siravan
            message= _ "Yes, indeed you will have passage through... to whence you came. I trust you can find yourselves out, otherwise my servants will show you the way..."
        [/message]
        [message]
            speaker=Lich-Lord Siravan
            message= _ "And what is that clamor?

...Elves? Did you dragons tow elves to this place of fruitful solitude?"
        [/message]
        [message]
            speaker=Arinexis
            message= _ "*sniff* *sniff*

Dragonsss! Gate behind talking boness ssmellsss of good air. That is way through mountain. We mussst break through that gate! With hassste, dragonsss!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Lich-Lord Siravan
        [/filter]
        [message]
            speaker=Lich-Lord Siravan
            message= _  "An age past, I trekked the depths beneath the Maelstrom Ocean to find a place so tranquil as this. Yet now, it seems I may find no peace here to conduct my necessary work from which you all gain in ways you care not to fathom. Even if I alone completed the transmutation of our entire sub-realm, would it be praised?"
        [/message]
        [message]
            speaker=Lich-Lord Siravan
            message= _ "Nevermind. Dragon, I have much toil of the mind to uplift to the aether before my present corporeal manifestation is irrelevant, elsewise my progress will be set back a century. I offer you passage for a truce. If you agree, then my servants will be of no further trouble to you."
        [/message]
        [message]
            speaker=Gorlack
            message= _ "You shall…"
            [option]
                description= _ "have your truce."
                [command]
                    [modify_side]
                        side=2,3,4
                        team_name=hero
                    [/modify_side]
                    [modify_unit]
                        [filter]
                            id=Passage_Gate
                        [/filter]
                        side=5
                    [/modify_unit]
                    {FULL_HEAL (id=Lich-Lord Siravan)}
                [/command]
            [/option]
            [option]
                description= _ "meet your doom."
                [message]
                    speaker=Lich-Lord Siravan
                    message= _ "A pity. I rather fancied this body."
                [/message]
            [/option]
        [/message]
    [/event]

    [event]
        name=sighted
        [filter]
            side=2
            type_adv_tree=Skeleton, Skeleton Archer, Lich
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [scroll_to_unit]
            id=$unit.id
            highlight=yes
        [/scroll_to_unit]
        [delay]
            time=1500
        [/delay]
        [message]
            side=1
            race=drake
            message= _ "Such a sickly looking creature."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            [filter_location]
                terrain=Urb
            [/filter_location]
        [/filter]
        [switch]
            variable=unit.id
            [case]
                value=Reshan
                [message]
                    speaker=Reshan
                    message= _ "Nay. Gorlack, I will not depart this cave before you!"
                [/message]
                [allow_undo]
                [/allow_undo]
            [/case]
            [case]
                value=Gorlack
                [if]
                    [have_unit]
                        id=Arinexis,Zedrix
                    [/have_unit]
                    [then]
                        [message]
                            speaker=Gorlack
                            message= _ "Those two saurians do not keep pace… yet I will not forsake them to such a place as this."
                        [/message]
                        [allow_undo]
                        [/allow_undo]
                    [/then]
                    [else]
                        [endlevel]
                            result=victory
                        [/endlevel]
                    [/else]
                [/if]
            [/case]
            [else]
                # store unit in a var, and put on recall list at end of scenario
                [heal_unit]
                    [filter]
                        id=$unit.id
                    [/filter]
                    moves=full
                [/heal_unit]
                [store_unit]
                    [filter]
                        id=$unit.id
                    [/filter]
                    variable=escaped_units
                    mode=append
                    kill=yes
                [/store_unit]
            [/else]
        [/switch]
    [/event]

    [event]
        name=victory
        [message]
            speaker=Reshan
            message= _ "Go on, my friend. I will make sure none follow. Leave this cave behind."
        [/message]
        [message]
            speaker=Gorlack
            message= _ "Nay, there is no time, we leave now."
        [/message]
        [message]
            speaker=Reshan
            message= _ "Tell Karron I always regretted taking his place."
        [/message]
        [message]
            speaker=Gorlack
            message= _ "Reshan, we leave this cave together. Just like we did the first one."
        [/message]
        [message]
            speaker=Reshan
            message= _ "farewell my friend"
        [/message]
        [message]
            speaker=Gorlack
            message= _ "reshan"
        [/message]
        [move_unit]
            id=Reshan
            to_x,to_y=29,35
        [/move_unit]
        {MODIFY_UNIT id=Reshan facing nw}
        [message]
            speaker=Reshan
            message= _ "My wings catch the Wind…"
        [/message]
        [animate_unit]
            [filter]
                id=Reshan
            [/filter]
            flag=attack
            [primary_attack]
                name=fire breath
            [/primary_attack]
            [facing]
                x,y=28,34
            [/facing]
        [/animate_unit]
        {FLASH_RED ()}
        [sound]
            name=explosion.ogg
        [/sound]
        [delay]
            time=2000
        [/delay]
        [sound]
            name=rumble.ogg
        [/sound]
        [delay]
            time=1000
        [/delay]
        [heal_unit]
            [filter]
                id=Gorlack,Reshan
            [/filter]
            moves=full
        [/heal_unit]
        [put_to_recall_list]
            id=Gorlack
        [/put_to_recall_list]
        # Reshan reappears later
        [store_unit]
            [filter]
                id=Reshan
            [/filter]
            variable=reshan
            kill=yes
        [/store_unit]
        [hide_unit]
            # everyone
        [/hide_unit]
        {FADE_TO_BLACK}
        [kill]
            side=1
            [not]
                x,y=recall,recall
            [/not]
        [/kill]
        # unstore units to recall list
        [foreach]
            array=escaped_units
            [do]
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE escaped_units}
    [/event]
[/scenario]
